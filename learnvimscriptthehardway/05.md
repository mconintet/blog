##严格的映射

准备好，因为事情将变得有点复杂。

到目前为止，我们使用 `map` `nmap` `vmap` 和 `imap` 去创建按键映射以节省时间。它们是可以工作的，但是存在一些潜在的风险。运行下面的命令：

```vim
:nmap - dd
:nmap \ -
```

现在试着按下 `\`（在普通模式下）。发生了什么？

当你按下按键 `\` Vim 发现了按键映射说 “我必须去运行 `-` ”。但是我们已经将 `-` 映射到了其他东西，Vim 发现了说 “噢，我必须运行 `dd`”，所以最后删除了当前行。

当你在做按键映射的时候，Vim 会对它们中相关的进行连接。这听起来似乎是一件好事，但实际上是很可怕的。让我们讨论为什么这么说，不过在此之前我们先移除刚刚的按键映射：

```vim
:nunmap - 
:nunmap \
```

##递归循环

运行下面的命令：

```vim
:nmap dd O<esc>jddk
```

首先简单的看下这个按键映射是映射 `dd`：
- 在当前行的上一行插入一个空行（此时光标在空行）
- 退出插入模式
- 下退一行
- 删除当前行
- 回到刚刚插入的空行

综合效果看起来就像是 “清空当前行”。试试看。

当你按下 `dd` 之后，Vim 将会冻结住。如果你按下 `<c-c>` 你可以将 Vim 带回来，但是你的文件中将会出现大量的空行。发生了什么？

这个映射实际上是*递归（recursive）*的！当你按下了 `dd`，Vim 认为：
* `dd` 是有映射的，所以要执行相应的映射
	* 新建一个空行
	* 退出插入模式
	* 下移一行
	* `dd` 是有映射的，所以要执行相应的映射
		* 新建一个空行
		* 退出插入模式
		* 下移一行
		* `dd` 是有映射的，所以要执行相应的映射
			* 如此循环...

这个映射将不会停止。通过下面的命令移除这个可怕的映射：

```vim
:nunmap dd
```

##副作用
`*map` 的按键映射一个风险就是循环调用。另一个的话，如果插件中刚好有映射依赖到它们，它们可能会影响插件的工作。

当你安装了一个新的 Vim 插件，你没有使用它或记住它的每一个命令，你也没有回头去查看自己的 `~/.vimrc` 以确认没有自定义的按键映射已经被映射了。

这样的话就会使得安装插件变成一个可怕和危险的事情。必须有一个更好的方案。

##非递归的按键映射

Vim 提供了另外一组按键映射设置命令，它们将不会被连接到其他映射中。运行下面的命令：

```vim
:nmap x dd
:nnoremap \ x
```

现在按下 `\` 看看发生了什么。

当你按下了 `\` 键，Vim 忽略了 `x` 的映射，并按照 `x` 默认行为去运行。结果它删除了当前字符，而不是当前行。

每一个 `*map` 命令都有一个对应的 `*noremap` 命令：`noremap` `nnoremap` `vnoremap` 和 `inoremap`。

什么时候我们应该用非递归的映射去替换使用递归映射呢？

**无例外的（Always）**。

**没错，很严肃的说，无例外的**。

使用一个光秃秃的 `*map` 就是在挖坑。当你安装了一个新的插件或者添加一个新的自定义映射时就会不小心踩到坑。为了你自己多输入几个字符去避免这个问题的发生。

##练习

将你的 `~/.vimrc` 中的之前几章涉及的按键映射都换成与之对应的非递归形式。

阅读 `:help unmap`。
