##模态映射

在上一节中我们讨论了如何在 Vim 中进行按键映射。我们使用了 `map` 命令，它可以在普通模式下工作。如果你在此之前已经试玩了此功能，你可能会发现它在可视模式下也能起作用。

当你在使用映射的时候，你可以通过 `nmap`，`vmap`，`imap` 去具体的设置映射应用的模式，它们分别对应的模式是 普通（normal），可视（visual）和 插入（insert）模式。

运行下面的代码：

```vim
:nmap \ dd
```

现在你可以将光标放到文本中，确认下当前是在普通模式下，然后按下 `\` 键。 Vim 将会删除当前行。

现在进入可视模式并且按下 `\` 键。什么都不会发生，因为我们告诉 Vim 我们的映射只工作在普通模式下就可以了（并且 `\` 默认在可视模式下是不做任何事的）。

运行下面的代码：

```vim
:vmap \ U
```

进入可视模式并且选择一些文本，然后按下 `\` 键。Vim 将会将它们转换成大写。

在普通模式和可视模式下分别试试 `\` 键，现在你可以发现它在两个模式下的行为完全不同，而这取决于我们当前所在的模式。

## 肌肉记忆

一个按键会根据当前所在的不同模式而表现出不同的效果，这是一件听起来很可怕的事情。为什么你需要在按下键之前先停下来思考下当前所在的模式？这样的话映射所带来的效率不就没有了吗？

实践表明这不是问题。一旦你开始经常使用 Vim，你将不用去记住不同的按键。你会想到 “删除一行” 而不是 “按下 dd”。你的手指和大脑将会记住映射和不同的按键，使它们都成为一个下意识的行为。

##插入模式

现在我们已经介绍了按键映射如何应用于普通模式和可视模式下，让我们继续看看插入模式。运行下面的命令：

```vim
:imap <c-d> dd
```

你可能会想到上面的命令是让你按下 `Ctrl+d` 可以在插入模式下删除当前行。这将是很方便的，因为你不喜欢先返回到普通模式，然后在删除。

继续试试它。没有工作 - 取而代之的是你插入了两个 `d`，这是毫无意义的。

要让这个映射可以按照我们预期的方式去运行，我们必须显式的去要求它。运行下面的命令去修改下刚刚的映射：

```vim
:imap <c-d> <esc>dd
```

上面的 `esc` 键就是我们告知 Vim 帮我们按下 Escape 键，这会将我们带到插入模式中。

现在试试上面的映射，它可以工作了，但是请注意我们现在回到的插入模式。之所以这样是因为我们告诉 Vim 按键映射 `<c-d>` 需要离开插入模式并删除一行，但是我们没有告诉它再将我们带回到插入模式。

运行一个更加有效的命令去解决上面的问题：

```vim
:imap <c-d> <esc>ddi
```

最后的 `i` 键就是进入到插入模式，这样我们的按键映射就完成了。

##练习

设置一个按键映射使得按下 `<c-u>` 可以在插入模式下将当前的单词转换成大写。记住 `U` 在可视模式下可以将选中的内容转换成大写，我发现这个功能是非常有用的，当我在写一个有很长名字的常量 `MAX_CONNECTIONS_ALLOWED` 时，我需要先输入一串小写然后使用 shift 去选中它们，再将其转换成大写。

将这个映射添加到你的 `~/.vimrc` 文件中。

设置一个按键映射，使得你可以在普通模式下将当前单词转换成大写。

将这个映射添加到你的 `~/.vimrc` 文件中。
